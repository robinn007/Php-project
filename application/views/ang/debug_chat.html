<!DOCTYPE html>
<html>
<head>
    <title>Debug Chat Modal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.0/angular.min.js"></script>
    <style>
        .test-container {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 5px;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body ng-app="testApp" ng-controller="TestController">
    <div class="test-container">
        <h1>Debug: Group Chat Modal</h1>
        
        <div class="debug-section">
            <h3>Debug Information</h3>
            <div class="debug-info">
                <p><strong>showCreateGroupModal:</strong> {{ showCreateGroupModal }}</p>
                <p><strong>newGroupName:</strong> "{{ newGroupName }}"</p>
                <p><strong>selectedMembers:</strong> {{ selectedMembers }}</p>
                <p><strong>Controller Loaded:</strong> {{ controllerLoaded }}</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>Test Buttons</h3>
            <button class="btn btn-primary" ng-click="openCreateGroupModal()">
                Open Group Modal (Primary Function)
            </button>
            <button class="btn btn-secondary" ng-click="testModal()">
                Test Modal Function
            </button>
            <button class="btn btn-secondary" ng-click="toggleModalDirectly()">
                Toggle Modal Directly
            </button>
        </div>

        <div class="debug-section">
            <h3>Sample Students List</h3>
            <div ng-repeat="student in sampleStudents">
                <label>
                    <input type="checkbox" ng-checked="isMemberSelected(student)" 
                           ng-click="toggleMemberSelection(student)">
                    {{ student.name }} ({{ student.email }})
                </label>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div class="modal-overlay" ng-show="showCreateGroupModal" ng-click="closeCreateGroupModal()">
        <div class="modal-content" ng-click="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Create New Group</h3>
                <button class="close-btn" ng-click="closeCreateGroupModal()">Ã—</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="groupName">Group Name *</label>
                    <input type="text" id="groupName" ng-model="newGroupName" 
                           placeholder="Enter group name" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="groupDescription">Description (Optional)</label>
                    <textarea id="groupDescription" ng-model="newGroupDescription" 
                              placeholder="Enter group description" class="form-input" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Select Members *</label>
                    <div ng-repeat="student in sampleStudents">
                        <label>
                            <input type="checkbox" ng-checked="isMemberSelected(student)" 
                                   ng-click="toggleMemberSelection(student)">
                            {{ student.name }} ({{ student.email }})
                        </label>
                    </div>
                    <p><strong>Selected:</strong> {{ selectedMembers.length }} members</p>
                </div>

                <div class="debug-info">
                    <p><strong>Group Name:</strong> {{ newGroupName }}</p>
                    <p><strong>Description:</strong> {{ newGroupDescription }}</p>
                    <p><strong>Selected Members:</strong> {{ selectedMembers }}</p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" ng-click="closeCreateGroupModal()">Cancel</button>
                <button type="button" class="btn btn-primary" ng-click="createGroup()" 
                        ng-disabled="!newGroupName || selectedMembers.length === 0">
                    Create Group
                </button>
            </div>
        </div>
    </div>

    <script>
        angular.module('testApp', [])
        .controller('TestController', ['$scope', function($scope) {
            console.log('TestController initialized');
            
            $scope.controllerLoaded = true;
            $scope.showCreateGroupModal = false;
            $scope.newGroupName = '';
            $scope.newGroupDescription = '';
            $scope.selectedMembers = [];
            
            // Sample students data
            $scope.sampleStudents = [
                { id: 1, name: 'John Doe', email: 'john@example.com' },
                { id: 2, name: 'Jane Smith', email: 'jane@example.com' },
                { id: 3, name: 'Bob Johnson', email: 'bob@example.com' },
                { id: 4, name: 'Alice Brown', email: 'alice@example.com' }
            ];

            // Modal functions
            $scope.openCreateGroupModal = function() {
                console.log('Opening create group modal');
                $scope.showCreateGroupModal = true;
                $scope.newGroupName = '';
                $scope.newGroupDescription = '';
                $scope.selectedMembers = [];
            };

            $scope.closeCreateGroupModal = function() {
                console.log('Closing create group modal');
                $scope.showCreateGroupModal = false;
                $scope.newGroupName = '';
                $scope.newGroupDescription = '';
                $scope.selectedMembers = [];
            };

            $scope.toggleModalDirectly = function() {
                console.log('Toggling modal directly');
                $scope.showCreateGroupModal = !$scope.showCreateGroupModal;
            };

            $scope.testModal = function() {
                console.log('Test modal function called');
                alert('Modal function is working!');
            };

            $scope.toggleMemberSelection = function(student) {
                if (!student || !student.email) {
                    console.error('Invalid student object:', student);
                    return;
                }
                
                var index = $scope.selectedMembers.indexOf(student.email);
                if (index > -1) {
                    $scope.selectedMembers.splice(index, 1);
                    console.log('Removed member:', student.email);
                } else {
                    $scope.selectedMembers.push(student.email);
                    console.log('Added member:', student.email);
                }
                console.log('Selected members:', $scope.selectedMembers);
            };

            $scope.isMemberSelected = function(student) {
                if (!student || !student.email) {
                    return false;
                }
                return $scope.selectedMembers.indexOf(student.email) > -1;
            };

            $scope.createGroup = function() {
                console.log('Creating group:', {
                    name: $scope.newGroupName,
                    description: $scope.newGroupDescription,
                    members: $scope.selectedMembers
                });
                
                alert('Group created successfully!\n' + 
                      'Name: ' + $scope.newGroupName + '\n' +
                      'Members: ' + $scope.selectedMembers.length);
                
                $scope.closeCreateGroupModal();
            };
        }]);
    </script>
</body>
</html>